{"version":3,"sources":["webpack://[name].js/webpack/universalModuleDefinition","webpack://[name].js/webpack/bootstrap","webpack://[name].js/./esm/Socket/index.js"],"names":["Socket","url","options","autoConnect","getEmitId","String","_emitId","handleEmitParams","reqId","name","params","handleResponseCallbackParams","resId","handleMessage","message","listenerCallback","emitCallback","responseCallback","data","JSON","parse","result","undefined","_url","_emitStorage","_listenerStorage","_socket","_io","open","reject","close","resolve","addEventListener","__message","bind","__close","event","_handleListener","_handleEmit","_handleResponse","cbs","length","cb","apply","io","then","socket","callback","_handleResponseCallback","concat","send","stringify","Promise","WebSocket","__error","__open","code","reason","pop","push","index","indexOf","splice"],"mappings":"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","file":"Socket.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Socket.js\"] = factory();\n\telse\n\t\troot[\"Socket.js\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./esm/Socket/index.js\");\n","class Socket {\r\n  constructor (url, options) {\r\n    this.options = {\r\n      autoConnect: false,\r\n      getEmitId: () => String(this._emitId++),\r\n      handleEmitParams: (reqId, name, params) => ({ reqId, name, params }),\r\n      handleResponseCallbackParams: (resId, name, params) => ({ resId, name, params }),\r\n      handleMessage: (message, listenerCallback, emitCallback, responseCallback) => {\r\n        const data = JSON.parse(message)\r\n        if (data.reqId) return emitCallback(data.resId, data.result)\r\n        if (data.resId) return responseCallback(data.resId, data.name, data.params)\r\n        return listenerCallback(undefined, data.name, data.result)\r\n      },\r\n      ...options\r\n    }\r\n\r\n    this._url = url\r\n\r\n    this._emitId = 0\r\n    this._emitStorage = {}\r\n    this._listenerStorage = {}\r\n\r\n    this._socket = null\r\n    this._io = null\r\n\r\n    if (options.autoConnect) {\r\n      this.open()\r\n    }\r\n  }\r\n\r\n  __error (reject) {\r\n    this.close()\r\n    return reject()\r\n  }\r\n\r\n  __open (resolve) {\r\n    this._socket.addEventListener('message', this.__message.bind(this))\r\n    this._socket.addEventListener('close', this.__close.bind(this))\r\n    return resolve()\r\n  }\r\n\r\n  __close () {\r\n    this.close()\r\n  }\r\n\r\n  __message (event) {\r\n    return this.options.handleMessage(\r\n      event.data,\r\n      this._handleListener.bind(this),\r\n      this._handleEmit.bind(this),\r\n      this._handleResponse.bind(this)\r\n    )\r\n  }\r\n\r\n  _handleListener (name, ...result) {\r\n    const cbs = this._listenerStorage[name]\r\n    if (!cbs || !cbs.length) return\r\n    for (const cb of cbs) {\r\n      cb && cb.apply(this, result)\r\n    }\r\n  }\r\n\r\n  _handleEmit (resId, ...result) {\r\n    const cb = this._emitStorage[resId]\r\n    delete this._emitStorage[resId]\r\n    return cb && cb.apply(this, result)\r\n  }\r\n\r\n  _handleResponse (reqId, name, ...params) {\r\n    return this.io().then((socket) => {\r\n      const callback = this._handleResponseCallback.bind(this, reqId, name)\r\n      return this._handleListener(name, ...params.concat(callback))\r\n    })\r\n  }\r\n\r\n  _handleResponseCallback (resId, name, ...result) {\r\n    const data = this.options.handleResponseCallbackParams(resId, name, result)\r\n    this.io().then((socket) => socket.send(JSON.stringify(data)))\r\n  }\r\n\r\n  // 打开链接\r\n  open (url) {\r\n    if (url) this._url = url\r\n    return new Promise((resolve, reject) => {\r\n      this._socket = new WebSocket(this._url)\r\n      this._socket.addEventListener('error', this.__error.bind(this, reject))\r\n      this._socket.addEventListener('open', this.__open.bind(this, resolve))\r\n      return this\r\n    })\r\n  }\r\n\r\n  // 关闭连接\r\n  close (code, reason) {\r\n    if (this._socket) {\r\n      this._socket.close(code, reason)\r\n    }\r\n    this._socket = null\r\n    this._io = null\r\n    return this\r\n  }\r\n\r\n  // 获取 socket\r\n  io () {\r\n    if (this._io) return this._io\r\n    this._io = this.open().then(() => this._socket)\r\n    return this._io\r\n  }\r\n\r\n  // 获取一个发送ID\r\n  getEmitId () {\r\n    return this.options.getEmitId()\r\n  }\r\n\r\n  // 发送事件\r\n  emit (name, ...params) {\r\n    const callback = typeof params[params.length - 1] === 'function' ? params.pop() : undefined\r\n    let reqId\r\n    if (callback) {\r\n      reqId = this.getEmitId(name, params)\r\n      this._emitStorage[reqId] = callback\r\n    }\r\n    const data = this.options.handleEmitParams(reqId, name, params)\r\n    this.io().then((socket) => {\r\n      socket.send(JSON.stringify(data))\r\n    })\r\n    return this\r\n  }\r\n\r\n  // 监听事件\r\n  on (name, callback) {\r\n    if (!callback) return this\r\n    if (!this._listenerStorage[name]) {\r\n      this._listenerStorage[name] = []\r\n    }\r\n    this._listenerStorage[name].push(callback)\r\n    this.io()\r\n    return this\r\n  }\r\n\r\n  // 关闭监听事件\r\n  off (name, callback) {\r\n    if (!this._listenerStorage[name]) return this\r\n    if (!callback) {\r\n      this._listenerStorage[name] = []\r\n    } else {\r\n      const index = this._listenerStorage[name].indexOf(callback)\r\n      if (index >= 0) {\r\n        this._listenerStorage[name].splice(index, 1)\r\n      }\r\n    }\r\n    return this\r\n  }\r\n}\r\n\r\nexport { Socket }\r\nexport default Socket\r\n"],"sourceRoot":""}